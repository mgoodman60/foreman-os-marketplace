---
description: Generate the Project Data Intelligence dashboard — room browser, takeoffs, calculator, bidding, chatbot, and full project data visualization
allowed-tools: Read, Write, Edit, Bash, Glob, Grep
argument-hint: [section-name]
---

Generate a comprehensive Project Data Intelligence HTML dashboard showing ALL extracted project data with interactive tools.

Read the project-data-intel skill at `${CLAUDE_PLUGIN_ROOT}/skills/project-data-intel/SKILL.md` before proceeding.

## Step 1: Load ALL Data

Search for project data files in the user's working directory (check `AI - Project Brain/` first, then root). Load EVERY available file:

**Required:**
- `project-config.json` — project basics, documents loaded, version history
- `plans-spatial.json` — grid, building areas, rooms, doors, MEP, structural, site, quantities

**Full Dataset (load all that exist):**
- `schedule.json` — milestones, critical path, long-lead items
- `directory.json` — team, subcontractors, vendors
- `specs-quality.json` — CSI spec sections, testing, tolerances
- `submittal-log.json` — submittal tracking
- `procurement-log.json` — procurement and delivery tracking
- `inspection-log.json` — hold points, permits, inspections
- `daily-report-data.json` — report history
- `rfi-log.json` — RFI tracking
- `meeting-log.json` — meeting notes
- `delay-log.json` — delay events
- `pay-app-log.json` — payment applications
- `change-order-log.json` — change orders
- `punch-list.json` — punch list items
- `visual-context.json` — site and interior visual context (from /site-context)
- `rendering-log.json` — rendering history (from /render)

If `project-config.json` doesn't exist:
- Tell the user: "No project is set up yet. Run /set-project first."

## Step 2: Determine Focus

If the user provided an argument ($ARGUMENTS):
- Jump directly to that sidebar section on load
- No argument → Default to Overview

## Step 3: Locate API Keys

Search for API keys to enable AI features:
1. Check environment variables: `ANTHROPIC_API_KEY`, `GEMINI_API_KEY`, `FLUX2_API_KEY`
2. Check `project-config.json` for `api_keys` object
3. Check for `.env` file in project root
4. Keys not found = features degrade gracefully (chatbot → keyword mode, rendering → SVG only)

## Step 4: Check for Incremental Update

Check if `{PROJECT_CODE}_data.js` already exists in the output folder:

**If YES (incremental update):**
1. Read the existing data.js file
2. Extract the DATA_MANIFEST object using regex
3. For each JSON file:
   - Compute a simple hash (file size + last modified timestamp)
   - Compare to manifest entry
   - If unchanged → reuse existing serialized data
   - If changed → re-read and re-serialize
4. Write updated data.js with mixed cached + fresh data
5. Update manifest with new hashes and timestamp
6. Report: "Updated data.js — X of Y files changed"

**If NO (first run):**
1. Read ALL JSON files
2. Serialize everything into PROJECT_DATA object
3. Build fresh DATA_MANIFEST
4. Copy `data-intel-template.html` from `${CLAUDE_PLUGIN_ROOT}/skills/project-data-intel/references/data-intel-template.html` to the output folder as `{PROJECT_CODE}_Data_Intel.html`
5. Write `{PROJECT_CODE}_data.js`
6. Report: "Generated dashboard + data file"

**If manifest is corrupted:**
- Fall back to full regeneration
- Log: "Manifest corrupted — performing full regeneration"

## Step 5: Write data.js

The data.js file structure:

```javascript
// Auto-generated by Foreman OS /data command
// Generated: {timestamp}
// Template version: 3.0.0

const PROJECT_DATA = {
  config: {/* project-config.json contents */},
  spatial: {/* plans-spatial.json contents */},
  specs: {/* specs-quality.json contents */},
  schedule: {/* schedule.json contents */},
  directory: {/* directory.json contents */},
  submittals: {/* submittal-log.json contents */},
  procurement: {/* procurement-log.json contents */},
  inspections: {/* inspection-log.json contents */},
  dailyReports: {/* daily-report-data.json contents */},
  rfis: {/* rfi-log.json contents */},
  meetings: {/* meeting-log.json contents */},
  delays: {/* delay-log.json contents */},
  payApps: {/* pay-app-log.json contents */},
  changeOrders: {/* change-order-log.json contents */},
  punchList: {/* punch-list.json contents */},
  visualContext: {/* visual-context.json contents */},
  renderings: {/* rendering-log.json contents */}
};

const API_KEYS = {
  anthropic: '{discovered_key_or_empty}',
  gemini: '{discovered_key_or_empty}',
  flux2: '{discovered_key_or_empty}'
};

const ACTIVE_ROLE = 'superintendent';

const DATA_MANIFEST = {
  generated: '{ISO_timestamp}',
  template_version: '3.0.0',
  files: {
    'project-config.json': { hash: '{hash}', modified: '{date}', size: {bytes} },
    // ... one entry per JSON file
  }
};
```

For any JSON file that doesn't exist, set its PROJECT_DATA key to an empty object {}.

## Step 6: Save and Present

Save data.js as `{PROJECT_CODE}_data.js` in the same folder as the HTML template (AI - Project Brain/ or the configured output folder).

If first run, also copy the HTML template.

Present to user: "Here's your Project Data Intelligence dashboard. It contains every piece of data extracted from your project documents. Use the sidebar to navigate sections, Ctrl+K to jump anywhere, and the AI chat at the bottom to ask questions about your data."
